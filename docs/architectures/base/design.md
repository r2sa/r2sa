# 常用设计手段

## 高可用设计手段
- what
	- 高可用通常是指，通过设计减少系统不能提供服务的时间。
- why
	- 硬件和软件带来的不可用性
- 高可用的衡量标准
	- 可用性
		- 在给定时间段内特定系统或组件的正常运行时间
	- 容灾恢复能力
		- RPO :（Recovery Point Obejective，恢复点目标）是指业务系统所允许的在灾难过程中的最大数据丢失量，用来衡量容灾系统的数据冗余备份能力
		- RTO :（Recovery Time Objective，恢复时间目标）是指信息系统从灾难状态恢复到可运行状态所需的时间，用来衡量容灾系统的业务恢复能力
- 设计手段
	- 服务冗余
	- 无状态化
	- 负载均衡
	- 幂等设计
	- 超时机制
	- 异步化设计
	- 服务限流降级熔断
	- 数据复制、缓存、sharding
	- 架构拆分、服务治理
	- 日志监控
	- 服务分级

### 如何无缝停止线上服务
- 若网关层已具备热切换能力
	- 热开关切换
		- 看server端日志打印情况
		- 按客户端超时时间
- 网关层不具备热切换能力
	- 防火墙限制只出不进
		- IPTABLES

## 高并发设计手段
- 系统性能
	- 吞吐量
	- 响应延时
	- 关系图 ![性能测试指标及其关系](/architectures/img/1.jpeg)
- 优化手段
	- 时间换空间
		- 数据大小是瓶颈
		- eg:gzip压缩
	- 空间换时间
		- 系统时间是瓶颈
		- eg:缓存
	- 找到系统瓶颈
		- 分析系统业务流程，找到关键路径并分解优化
			- 调用了多少个RPC接口
			- 载入了多少数据
			- 使用了什么算法
			- 非核心流程能否异步化
			- 没有数据依赖的逻辑能否并行执行
- 优化层次
	- 架构设计层次
		- 关注系统控制、数据流程
		- 如何拆分系统、如何使各部分系统负责更加均衡，充分发挥硬件设施性能优势，减少系统内部开销等
	- 算法逻辑层次
		- 关注算法选择是否高效，算法逻辑优化，空间时间优化，任务并行处理，使用无锁数据结构等
		- 空间换时间
		- 时间换空间
	- 代码优化层次

### 代码优化层次 (java为例，其他语言类比)
- 循环遍历是否合理
	- 不要在循环里调用RPC接口、查询分布式缓存、执行sql等
	- 先调批量接口组装好数据，再循环处理
- 代码逻辑避免生成过多对象或无效对象
	- 输出log时候的log级别判断，避免new无效对象
- ArrayList、HashMap 初始容量是否合理
	- 扩容代价
- 对数据对象是否合理重用，比如通过RPC查到的数据能复用择必须复用
- 根据数据访问特性选择合适的数据结构
	- 比如读多写少，考虑CopyOnWriteArrayList(写时拷贝副本)
- 拼接字符串时是使用String相加还是使用StringBuilder进行append
	- 在StringBuilder的容量预分配的情况下比String相加快5倍
- 是否正确初始化数据
	- 有些全局共享的数据，饿汉式模式，在用户访问之前先初始化好

### 数据库代码优化层次



## 服务无状态设计

## 服务负载均衡设计

## 服务幂等设计

## 分布式锁设计

## 分布式事务设计

## 服务降级设计

## 服务限流/熔断设计

## 服务灰度发布设计

## 服务全链路压测设计